title = "Каталог"
layout = "default"

url = "/catalog/:category*/:slug?"
is_hidden = 0

[CategoryPage MainCategoryPage]
slug = "{{ :category }}"
slug_required = 1
smart_url_check = 1
has_wildcard = 1
skip_error = 0

[CategoryPage]
slug = "{{ :slug }}"
slug_required = 0
smart_url_check = 1
has_wildcard = 0
skip_error = 1

[ProductList]
sorting = "price|desc"
==
function onInit() {
    $obMainCategoryItem = $this->MainCategoryPage->get();
    $obCategoryItem = $this->CategoryPage->get();

    if (empty($obCategoryItem)) {
        $obCategory = $obMainCategoryItem;
        $obProductList = $this->ProductList->make()->active()->category($obMainCategoryItem->id, true);
    } else {
        $obCategory = $obCategoryItem;
        $obProductList = $this->ProductList->make()->active()->category($obCategoryItem->id, true);
    }

    $this['obCategory'] = $obCategory;
    $this['obProductList'] = $obProductList;
}
==
{% put pageTitle %}
    {{ obCategory.name }}
{% endput %}
{% partial 'catalog/product-list' %}
